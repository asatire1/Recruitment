import{a as y,d as c,q as m,o as v,w,b,T as s,e as h,u as g,s as T,f as _,g as S}from"./index-NO_tzWV3.js";import{u as I,a as p}from"./candidates-DJnU1mRt.js";const P=[{value:"interview",label:"Interview"},{value:"trial",label:"Trial Day"}],D=[{value:"scheduled",label:"Scheduled",color:"primary"},{value:"completed",label:"Completed",color:"success"},{value:"cancelled",label:"Cancelled",color:"gray"},{value:"no_show",label:"No Show",color:"error"}],B=[{value:"in_person",label:"In Person"},{value:"phone",label:"Phone Call"},{value:"video",label:"Video Call"}],A=[{value:15,label:"15 minutes"},{value:30,label:"30 minutes"},{value:45,label:"45 minutes"},{value:60,label:"1 hour"},{value:90,label:"1.5 hours"},{value:120,label:"2 hours"},{value:240,label:"4 hours (half day)"},{value:480,label:"8 hours (full day)"}],u="interviews";async function L(e,t,a){const r=y(c,u),o=e.dateTime instanceof Date?s.fromDate(e.dateTime):s.fromDate(new Date(e.dateTime)),i={candidateId:e.candidateId,candidateName:e.candidateName||"",candidatePhone:e.candidatePhone||"",candidateEmail:e.candidateEmail||"",jobId:e.jobId||null,jobTitle:e.jobTitle||null,type:e.type||"interview",status:"scheduled",dateTime:o,duration:e.duration||30,location:e.location||null,locationType:e.locationType||"in_person",notes:e.notes||null,interviewerName:e.interviewerName||null,interviewerPhone:e.interviewerPhone||null,feedback:null,rating:null,createdBy:t,createdAt:T(),updatedAt:T()},n=await _(r,i),l=e.type==="trial"?"trial_scheduled":"interview_scheduled";await I(e.candidateId,{status:l});const d=e.type==="trial"?"Trial":"Interview";return await p(e.candidateId,{type:e.type==="trial"?"trial_scheduled":"interview_scheduled",description:`${d} scheduled for ${N(o)}`,metadata:{interviewId:n.id},createdBy:t,createdByName:a}),{id:n.id,...i}}async function E(e){const t=h(c,u,e),a=await S(t);return a.exists()?{id:a.id,...a.data()}:null}function O(e,t){const a=y(c,u),r=m(a,w("candidateId","==",e),v("dateTime","desc"));return b(r,o=>{const i=o.docs.map(n=>({id:n.id,...n.data()}));t(i)},o=>{console.error("Error subscribing to candidate interviews:",o)})}async function $(e,t,a,r){const o=h(c,u,e);t.dateTime&&(t.dateTime=t.dateTime instanceof Date?s.fromDate(t.dateTime):s.fromDate(new Date(t.dateTime)));const i={...t,updatedAt:T()};if(await g(o,i),t.status){const n=await E(e);if(n){let l=null,d=null,f=null;t.status==="completed"?(l=n.type==="trial"?"trial_complete":"interview_complete",d=n.type==="trial"?"trial_completed":"interview_completed",f=`${n.type==="trial"?"Trial":"Interview"} marked as completed`):t.status==="cancelled"?(d="interview_cancelled",f=`${n.type==="trial"?"Trial":"Interview"} was cancelled`):t.status==="no_show"&&(d="interview_no_show",f=`Candidate did not show up for ${n.type==="trial"?"trial":"interview"}`),l&&await I(n.candidateId,{status:l}),d&&a&&await p(n.candidateId,{type:d,description:f,metadata:{interviewId:e},createdBy:a,createdByName:r})}}return{id:e,...i}}function N(e){return e?(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"Unknown"}function j(e){return e?(e.toDate?e.toDate():new Date(e)).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"Unknown"}function k(e){return D.find(a=>a.value===e)||{value:e,label:e,color:"gray"}}function q(e){return e?(e.toDate?e.toDate():new Date(e))<new Date:!1}function U(e){if(!e)return!1;const t=e.toDate?e.toDate():new Date(e),a=new Date;return t.toDateString()===a.toDateString()}function V(e,t,a){const r=y(c,u),o=m(r,w("dateTime",">=",s.fromDate(e)),w("dateTime","<=",s.fromDate(t)),v("dateTime","asc"));return b(o,i=>{const n=i.docs.map(l=>({id:l.id,...l.data()}));a(n)},i=>{console.error("Error subscribing to interviews in range:",i),a([])})}export{A as D,P as I,B as L,D as a,O as b,L as c,q as d,j as f,k as g,U as i,V as s,$ as u};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BccKSe94.js","assets/index-DNzbPSZC.js","assets/index-DX7dYFDL.css"])))=>i.map(i=>d[i]);
import{c as ae,H as Pe,y as i,x as e,F as qe,a8 as Ae,ab as He,ac as Ge,z as Fe,a9 as oe,X as H,D as ze,C as de,A as Ke,L as Qe,ad as Xe,M as Ye,J as ea,G as aa}from"./index-DNzbPSZC.js";import{B}from"./Button-B_cPFrbZ.js";import{B as Ee,H as sa,C as xe,a as De,S as ta}from"./Header-2UuRp0-b.js";import{E as na}from"./EmptyState-Bexdu60a.js";import{F as we,E as Le,U as Y,C as ia}from"./CandidateFormModal-B4q0DTuV.js";import{g as ve,b as _e,e as Ce,n as Te,k as Ne,u as ee,a as la,o as ra,p as ca,m as $e,P as oa,q as da,f as re}from"./candidates-CkBR_c93.js";import{M as Ve}from"./mail-t-ocS1qv.js";import{P as Ie}from"./phone-BWhpnhQ2.js";import{C as ua}from"./calendar-jRFJk9ro.js";import{C as Be}from"./chevron-right-BKgnSCpN.js";import{P as Ze,T as be}from"./trash-2-WU6Zw85z.js";import{M as ma}from"./Modal-D9gEPvkf.js";import{u as Ue,E as ha}from"./useJobs-Zaj5_4wT.js";import{S as pa}from"./sparkles-Bx2SU-6H.js";import{u as xa}from"./useQuery-BZQ_EdT0.js";import"./jobs-ThLx_BE1.js";import"./sanitize-DKce5u_M.js";const ja=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],fa=ae("ellipsis-vertical",ja);const ga=[["path",{d:"M15 2h-4a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8",key:"14sh0y"}],["path",{d:"M16.706 2.706A2.4 2.4 0 0 0 15 2v5a1 1 0 0 0 1 1h5a2.4 2.4 0 0 0-.706-1.706z",key:"1970lx"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],va=ae("files",ga);const Ca=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Se=ae("loader",Ca);const Na=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],ba=ae("sliders-horizontal",Na);const wa=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ka=ae("zap",wa);function ya({candidate:a,onEdit:o,onDelete:c,onStatusChange:x,statuses:u=[]}){const y=Pe(),[N,D]=i.useState(!1),l=ve(a.status),k=m=>m?(m.toDate?m.toDate():new Date(m)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"Unknown",v=()=>{y(`/candidates/${a.id}`)},z=m=>{m.stopPropagation(),D(!N)},f=(m,S)=>{S.stopPropagation(),D(!1),m()};return e.jsxs("div",{className:"candidate-card",onClick:v,children:[e.jsxs("div",{className:"candidate-card-header",children:[e.jsx("div",{className:"candidate-card-avatar",children:_e(a)}),e.jsxs("div",{className:"candidate-card-identity",children:[e.jsx("h3",{className:"candidate-card-name",children:Ce(a)}),e.jsx(Ee,{variant:l.color,size:"sm",dot:!0,children:l.label})]}),e.jsx("button",{className:"candidate-card-menu-btn",onClick:z,"aria-label":"More options",children:e.jsx(fa,{size:20})})]}),e.jsxs("div",{className:"candidate-card-contact",children:[a.email&&e.jsxs("a",{href:`mailto:${a.email}`,className:"candidate-card-contact-item",onClick:m=>m.stopPropagation(),children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:a.email})]}),a.phone&&e.jsxs("a",{href:`tel:${a.phone}`,className:"candidate-card-contact-item",onClick:m=>m.stopPropagation(),children:[e.jsx(Ie,{size:14}),e.jsx("span",{children:a.phone})]})]}),e.jsxs("div",{className:"candidate-card-meta",children:[e.jsxs("div",{className:"candidate-card-meta-item",children:[e.jsx(qe,{size:14}),e.jsx("span",{children:a.jobTitle||"No position"})]}),e.jsxs("div",{className:"candidate-card-meta-item",children:[e.jsx(ua,{size:14}),e.jsx("span",{children:k(a.createdAt)})]}),a.cvUrl&&e.jsxs("a",{href:a.cvUrl,target:"_blank",rel:"noopener noreferrer",className:"candidate-card-meta-item candidate-card-cv",onClick:m=>m.stopPropagation(),children:[e.jsx(we,{size:14}),e.jsx("span",{children:"View CV"}),e.jsx(Le,{size:12})]})]}),e.jsx("div",{className:"candidate-card-arrow",children:e.jsx(Be,{size:20})}),N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"candidate-card-menu-backdrop",onClick:m=>{m.stopPropagation(),D(!1)}}),e.jsxs("div",{className:"candidate-card-menu",onClick:m=>m.stopPropagation(),children:[e.jsxs("button",{onClick:m=>f(()=>o(a),m),children:[e.jsx(Ze,{size:16}),"Edit Candidate"]}),e.jsx("div",{className:"candidate-card-menu-divider"}),e.jsx("div",{className:"candidate-card-menu-label",children:"Change Status"}),u.slice(0,6).map(m=>e.jsx("button",{onClick:S=>f(()=>x(a.id,m.value),S),className:a.status===m.value?"active":"",children:m.label},m.value)),e.jsx("div",{className:"candidate-card-menu-divider"}),e.jsxs("button",{className:"candidate-card-menu-danger",onClick:m=>f(()=>c(a),m),children:[e.jsx(be,{size:16}),"Delete"]})]})]})]})}let K=null,ce=null,je=null;function za(){return je||(je=He(Ge,"parseCV")),je}async function Da(){return K||(console.log("CV Parser - Loading pdf.js library..."),K=await Ae(()=>import("./pdf-CEWM7r6c.js"),[]),K.GlobalWorkerOptions.workerSrc=`https://unpkg.com/pdfjs-dist@${K.version}/build/pdf.worker.min.mjs`,K)}async function Sa(){if(ce)return ce;console.log("CV Parser - Loading mammoth.js library...");const a=await Ae(()=>import("./index-BccKSe94.js").then(o=>o.i),__vite__mapDeps([0,1,2]));return ce=a.default||a,ce}async function Ma(a,o={}){let c="";try{const u=a.name.split(".").pop().toLowerCase();if(u==="pdf")c=await Aa(a);else if(["doc","docx"].includes(u))c=await Fa(a);else throw new Error(`Unsupported file type: ${u}`)}catch(u){return console.error("Error extracting text from file:",u),Me(a.name)}if(!c||c.trim().length<50)return console.warn("Could not extract meaningful text from CV"),Me(a.name);console.log("CV Parser - Extracted text preview:",c.substring(0,500));try{return console.log("CV Parser - Using secure Cloud Function..."),{...await Pa(c),rawText:c.substring(0,5e3)}}catch(u){console.warn("Secure parsing failed, falling back to regex:",u.message)}const x=Ea(c,a.name);return{...x,rawText:c.substring(0,5e3),parsingMethod:"regex",confidence:x.email&&x.phone?"medium":"low"}}async function Pa(a){const c=await za()({cvText:a});if(!c.data.success)throw new Error(c.data.error||"Cloud Function parsing failed");return c.data.data}async function Aa(a){const o=await Da(),c=await a.arrayBuffer(),x=await o.getDocument({data:c}).promise;let u="";for(let y=1;y<=x.numPages;y++){const l=(await(await x.getPage(y)).getTextContent()).items.map(k=>k.str).join(" ");u+=l+`
`}return u.trim()}async function Fa(a){const o=await Sa(),c=await a.arrayBuffer();return(await o.extractRawText({arrayBuffer:c})).value.trim()}function Ea(a,o){const c=a.replace(/\s+/g," ").trim(),x=a.replace(/\s/g,""),u=[/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/gi,/[a-zA-Z0-9._%+-]+\s*@\s*[a-zA-Z0-9.-]+\s*\.\s*[a-zA-Z]{2,}/gi];let y=null;for(const g of u){const p=c.match(g);if(p&&p.length>0){y=p[0].replace(/\s/g,"").toLowerCase();break}}const N=[/(\+44|0044)?0?7\d{9}/,/(\+44|0044)?0?[1-9]\d{9,10}/,/(?:\+44|0044|0)[\s.-]*7[\s.-]*\d{3}[\s.-]*\d{3}[\s.-]*\d{3}/,/(?:\+44|0044|0)[\s.-]*7[\s.-]*\d{2}[\s.-]*\d{3}[\s.-]*\d{4}/,/(?:\+44|0044|0)[\s.-]*[1-9][\s.-]*\d{2,4}[\s.-]*\d{3}[\s.-]*\d{3,4}/,/07\d[\s.-]*\d{2}[\s.-]*\d{3}[\s.-]*\d{3}/,/07\d{3}[\s.-]*\d{6}/,/07\d{3}[\s.-]*\d{3}[\s.-]*\d{3}/,/\+44[\s.-]*7[\s.-]*\d{3}[\s.-]*\d{3}[\s.-]*\d{3}/];let D=null;for(const g of N.slice(0,2)){const p=x.match(g);if(p){D=fe(p[0]);break}}if(!D)for(const g of N.slice(2)){const p=c.match(g);if(p){D=fe(p[0]);break}}if(!D){const g=x.match(/(?:\+44|0)\d{10}/);g&&(D=fe(g[0]))}console.log("CV Parser - Extracted phone:",D),console.log("CV Parser - Extracted email:",y);const l=c.match(/[A-Z]{1,2}\d[A-Z\d]?\s*\d[A-Z]{2}/i),k=l?l[0].toUpperCase().replace(/\s+/g," "):null;let v=null,z=null;const f=[/(?:^|\n)\s*(?:CV|Resume|Curriculum\s*Vitae)\s*[\n\r]+\s*([A-Z][a-z]+)\s+([A-Z][a-z]+)/i,/(?:Name|Full Name)\s*[:\-]?\s*([A-Z][a-z]+)\s+([A-Z][a-z]+)/i,/^[\s\n]*([A-Z][a-z]+)\s+([A-Z][a-z]+)(?:\s|$|\n)/,/^[\s\n]*([A-Z][a-z]+)\s+(?:[A-Z][a-z]+\s+)?([A-Z][a-z]+)[\s\n]/];for(const g of f){const p=a.match(g);if(p&&p[1]&&p[2]){const r=["street","road","lane","drive","avenue","close","way","court","place","email","phone","mobile","address","personal","statement","education","experience","skills","summary","objective","profile"],d=p[1].toLowerCase(),n=p[2].toLowerCase();if(!r.includes(d)&&!r.includes(n)){v=Z(p[1]),z=Z(p[2]),console.log("CV Parser - Found name from text pattern:",v,z);break}}}if(!v){const g=a.toLowerCase().indexOf(y?.toLowerCase()||"~~~"),r=(g>0?a.substring(0,g):a.substring(0,500)).match(/([A-Z][a-z]+)\s+([A-Z][a-z]+)/);if(r){const d=["street","road","lane","drive","avenue","close","way","court","place","email","phone","mobile","address","personal","statement","curriculum","vitae"],n=r[1].toLowerCase(),j=r[2].toLowerCase();!d.includes(n)&&!d.includes(j)&&(v=Z(r[1]),z=Z(r[2]),console.log("CV Parser - Found name from header text:",v,z))}}if(!v){const g=Oe(o);g.firstName&&(v=g.firstName,z=g.lastName,console.log("CV Parser - Found name from filename:",v,z))}if(!v&&y){const p=y.split("@")[0].split(/[._-]/).filter(r=>r.length>1&&!/\d/.test(r));p.length>=2&&(v=Z(p[0]),z=Z(p[1]),console.log("CV Parser - Found name from email (separated):",v,z))}const m=["dispens","pharmacist","pharmacy","pharmaceutical","gphc","nhs","prescription","medication","healthcare","counter assistant","pharmacy technician","pre-reg"],S=c.toLowerCase(),M=m.some(g=>S.includes(g)),L=["customer service","communication","teamwork","microsoft office","excel","dispensing","patient care","attention to detail","time management","problem solving","leadership","training"].filter(g=>S.includes(g.toLowerCase()));let _=null;return M?_="Candidate has pharmacy/healthcare experience.":L.length>0&&(_=`Key skills: ${L.slice(0,3).join(", ")}.`),{firstName:v,lastName:z,email:y,phone:D,address:null,postcode:k,currentJobTitle:null,yearsExperience:null,skills:L,summary:_,pharmacyExperience:M,qualifications:[],rightToWork:null}}function Me(a){const{firstName:o,lastName:c}=Oe(a);return{firstName:o,lastName:c,email:null,phone:null,address:null,postcode:null,currentJobTitle:null,yearsExperience:null,skills:[],summary:`CV uploaded: ${a}. Manual review required.`,pharmacyExperience:!1,qualifications:[],rightToWork:null,parsingMethod:"filename-only",confidence:"low"}}function Oe(a){const x=a.replace(/\.[^.]+$/,"").replace(/[-_]/g," ").replace(/cv|resume|curriculum\s*vitae/gi,"").replace(/\d{4}|\d{2}/g,"").replace(/\(.*?\)/g,"").replace(/\s+/g," ").trim().split(" ").filter(u=>u.length>1);return x.length>=2?{firstName:Z(x[0]),lastName:Z(x[x.length-1])}:x.length===1?{firstName:Z(x[0]),lastName:null}:{firstName:null,lastName:null}}function fe(a){if(!a)return null;let o=a.replace(/[^\d+]/g,"");return o.startsWith("0044")&&(o="+44"+o.substring(4)),o.startsWith("0")&&o.length===11&&(o="+44"+o.substring(1)),o||null}function Z(a){return a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():""}function La({isOpen:a,onClose:o,preSelectedJobId:c=null,onSuccess:x}){const{user:u}=Fe(),{jobs:y}=Ue({status:"active"}),[N,D]=i.useState(c||""),[l,k]=i.useState([]),[v,z]=i.useState(!1),[f,m]=i.useState(!1),[S,M]=i.useState({}),[E,L]=i.useState(0),[_,g]=i.useState(!1),p=i.useRef(null),r=i.useRef(null),d=[".pdf",".doc",".docx"],n=10*1024*1024,j=y.find(t=>t.id===N),A=t=>{const b="."+t.name.split(".").pop().toLowerCase();return d.includes(b)?t.size>n?"File is too large. Maximum size is 10MB.":null:`Invalid file type. Only ${d.join(", ")} files are accepted.`},se=i.useCallback(t=>{const b=[],C=[];Array.from(t).forEach(h=>{const P=A(h);P?C.push({name:h.name,error:P}):l.some($=>$.file.name===h.name&&$.file.size===h.size)||b.push({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:h,status:"pending",error:null,parsedData:null,candidateId:null})}),C.length>0&&console.warn("Some files were rejected:",C),k(h=>[...h,...b])},[l]),te=t=>{t.preventDefault(),t.stopPropagation(),z(!0)},ne=t=>{t.preventDefault(),t.stopPropagation(),t.target===r.current&&z(!1)},O=t=>{t.preventDefault(),t.stopPropagation()},Q=t=>{t.preventDefault(),t.stopPropagation(),z(!1);const b=t.dataTransfer.files;b.length>0&&se(b)},R=t=>{t.target.files.length>0&&se(t.target.files),t.target.value=""},ue=t=>{k(b=>b.filter(C=>C.id!==t)),M(b=>{const C={...b};return delete C[t],C})},X=async()=>{if(!N||l.length===0)return;m(!0),L(0);for(let b=0;b<l.length;b++){const C=l[b];if(C.status==="success"){L(h=>h+1);continue}k(h=>h.map(P=>P.id===C.id?{...P,status:"processing"}:P)),M(h=>({...h,[C.id]:{step:"parsing",message:"Parsing CV..."}}));try{const h=await Ma(C.file);M(V=>({...V,[C.id]:{step:"creating",message:"Creating candidate..."}}));const P={firstName:h.firstName||"Unknown",lastName:h.lastName||"Candidate",email:h.email||"",phone:h.phone||"",address:h.address||null,postcode:h.postcode||null,jobId:N,jobTitle:j?.title||null,entityId:j?.entityId||null,branchId:j?.branchId||null,source:"cv_upload",notes:h.summary||null,parsedData:{...h,originalFileName:C.file.name,uploadedAt:new Date().toISOString()}},T=await Te(P,u.uid);M(V=>({...V,[C.id]:{step:"uploading",message:"Uploading CV..."}}));const $=await Ne(C.file,T.id);await ee(T.id,$),await la(T.id,{type:"cv_uploaded",description:`CV uploaded via bulk upload: ${C.file.name}`,metadata:{fileName:C.file.name,parsedData:h},createdBy:u.uid,createdByName:u.displayName||u.email}),k(V=>V.map(G=>G.id===C.id?{...G,status:"success",parsedData:h,candidateId:T.id}:G)),M(V=>({...V,[C.id]:{step:"complete",message:"Candidate created!"}}))}catch(h){console.error("Error processing file:",C.file.name,h),k(P=>P.map(T=>T.id===C.id?{...T,status:"error",error:h.message}:T)),M(P=>({...P,[C.id]:{step:"error",message:h.message}}))}L(h=>h+1)}m(!1);const t=l.filter(b=>b.status==="success").length;t>0&&x&&x(t)},ie=()=>{f||(k([]),M({}),L(0),D(c||""),o())},me=t=>{switch(t){case"processing":return e.jsx(Se,{size:16,className:"animate-spin status-icon-processing"});case"success":return e.jsx(ze,{size:16,className:"status-icon-success"});case"error":return e.jsx(de,{size:16,className:"status-icon-error"});default:return e.jsx(we,{size:16,className:"status-icon-pending"})}},J=t=>{if(t===0)return"0 Bytes";const b=1024,C=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(t)/Math.log(b));return parseFloat((t/Math.pow(b,h)).toFixed(1))+" "+C[h]},le=l.length>0?E/l.length*100:0,U=l.filter(t=>t.status==="success").length,W=l.filter(t=>t.status==="error").length,I=l.filter(t=>t.status==="pending").length;return e.jsx(ma,{isOpen:a,onClose:ie,title:"Bulk CV Upload",size:"lg",children:e.jsxs("div",{className:"bulk-upload",children:[e.jsxs("div",{className:"ai-status-banner ai-enabled",children:[e.jsx(ka,{size:16}),e.jsxs("span",{children:[e.jsx("strong",{children:"AI Parsing Active"})," — Claude will intelligently extract candidate details"]})]}),e.jsxs("div",{className:"bulk-upload-job-select",children:[e.jsx("label",{children:"Link to Job Position"}),e.jsxs("div",{className:"job-select-dropdown",onClick:()=>g(!_),children:[e.jsx("div",{className:"job-select-value",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"job-select-title",children:j.title}),e.jsx("span",{className:"job-select-location",children:j.location})]}):e.jsx("span",{className:"job-select-placeholder",children:"Select a job position..."})}),e.jsx(oe,{size:18,className:_?"rotated":""}),_&&e.jsx("div",{className:"job-select-options",children:y.length===0?e.jsx("div",{className:"job-select-empty",children:"No active jobs found"}):y.map(t=>e.jsxs("div",{className:`job-select-option ${t.id===N?"selected":""}`,onClick:b=>{b.stopPropagation(),D(t.id),g(!1)},children:[e.jsx("span",{className:"job-option-title",children:t.title}),e.jsx("span",{className:"job-option-location",children:t.location})]},t.id))})]})]}),e.jsxs("div",{ref:r,className:`bulk-upload-dropzone ${v?"dragging":""} ${l.length>0?"has-files":""}`,onDragEnter:te,onDragLeave:ne,onDragOver:O,onDrop:Q,onClick:()=>!f&&p.current?.click(),children:[e.jsx("input",{ref:p,type:"file",accept:d.join(","),multiple:!0,onChange:R,className:"bulk-upload-input",disabled:f}),l.length===0?e.jsxs("div",{className:"bulk-upload-placeholder",children:[e.jsx("div",{className:"bulk-upload-icon",children:e.jsx(Y,{size:28})}),e.jsxs("div",{className:"bulk-upload-text",children:[e.jsx("span",{className:"bulk-upload-text-primary",children:"Drop CVs here or click to browse"}),e.jsx("span",{className:"bulk-upload-text-secondary",children:"Supports PDF, DOC, DOCX • Up to 10MB each"})]}),e.jsxs("div",{className:"bulk-upload-ai-badge",children:[e.jsx(pa,{size:14}),e.jsx("span",{children:"AI will extract candidate details automatically"})]})]}):e.jsxs("div",{className:"bulk-upload-add-more",children:[e.jsx(Y,{size:18}),e.jsx("span",{children:"Drop more files or click to add"})]})]}),l.length>0&&e.jsxs("div",{className:"bulk-upload-files",children:[e.jsxs("div",{className:"bulk-upload-files-header",children:[e.jsxs("span",{className:"files-count",children:[l.length," file",l.length!==1?"s":""," selected"]}),!f&&e.jsx("button",{className:"files-clear",onClick:()=>k([]),children:"Clear all"})]}),e.jsx("div",{className:"bulk-upload-file-list",children:l.map(t=>e.jsxs("div",{className:`bulk-upload-file-item ${t.status}`,children:[e.jsx("div",{className:"file-item-icon",children:me(t.status)}),e.jsxs("div",{className:"file-item-info",children:[e.jsx("span",{className:"file-item-name",children:t.file.name}),e.jsxs("span",{className:"file-item-meta",children:[t.status==="processing"&&S[t.id]?.message,t.status==="success"&&e.jsxs(e.Fragment,{children:[t.parsedData?.firstName," ",t.parsedData?.lastName,t.parsedData?.email&&` • ${t.parsedData.email}`]}),t.status==="error"&&t.error,t.status==="pending"&&J(t.file.size)]})]}),!f&&t.status!=="success"&&e.jsx("button",{className:"file-item-remove",onClick:b=>{b.stopPropagation(),ue(t.id)},children:e.jsx(H,{size:16})})]},t.id))})]}),f&&e.jsxs("div",{className:"bulk-upload-progress",children:[e.jsxs("div",{className:"progress-header",children:[e.jsxs("span",{children:["Processing ",E," of ",l.length," files..."]}),e.jsxs("span",{children:[Math.round(le),"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${le}%`}})})]}),!f&&(U>0||W>0)&&e.jsxs("div",{className:"bulk-upload-summary",children:[U>0&&e.jsxs("div",{className:"summary-item success",children:[e.jsx(ze,{size:16}),e.jsxs("span",{children:[U," candidate",U!==1?"s":""," created successfully"]})]}),W>0&&e.jsxs("div",{className:"summary-item error",children:[e.jsx(de,{size:16}),e.jsxs("span",{children:[W," file",W!==1?"s":""," failed to process"]})]})]}),e.jsxs("div",{className:"bulk-upload-actions",children:[e.jsx(B,{variant:"outline",onClick:ie,disabled:f,children:U>0?"Close":"Cancel"}),e.jsx(B,{onClick:X,disabled:!N||I===0||f,leftIcon:f?e.jsx(Se,{size:16,className:"animate-spin"}):e.jsx(Y,{size:16}),children:f?"Processing...":`Upload ${I>0?I:""} CV${I!==1?"s":""}`})]})]})})}function _a(a={}){const[o,c]=i.useState([]),[x,u]=i.useState(!0),[y,N]=i.useState(!1),[D,l]=i.useState(null),[k,v]=i.useState(!1),{user:z}=Fe(),f=i.useRef(null),m=i.useRef(!0);i.useEffect(()=>{u(!0),l(null),c([]),f.current=null,m.current=!0;const r=ra(({candidates:d,lastDoc:n,hasMore:j,error:A})=>{if(A){l(A.message||"Failed to load candidates"),u(!1);return}c(d),f.current=n,v(j),u(!1)},{status:a.status,jobId:a.jobId});return()=>r()},[a.status,a.jobId]);const S=i.useCallback(async()=>{if(!(!k||y||!f.current)){N(!0),m.current=!1;try{const{candidates:r,lastDoc:d,hasMore:n}=await ca(f.current,{status:a.status,jobId:a.jobId});c(j=>[...j,...r]),f.current=d,v(n)}catch(r){l(r.message||"Failed to load more candidates")}finally{N(!1)}}},[k,y,a.status,a.jobId]),M=i.useMemo(()=>{let r=[...o];if(a.search){const d=a.search.toLowerCase();r=r.filter(n=>n.firstName?.toLowerCase().includes(d)||n.lastName?.toLowerCase().includes(d)||n.email?.toLowerCase().includes(d)||n.phone?.includes(a.search)||`${n.firstName} ${n.lastName}`.toLowerCase().includes(d))}if(a.dateFrom){const d=new Date(a.dateFrom);d.setHours(0,0,0,0),r=r.filter(n=>(n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt))>=d)}if(a.dateTo){const d=new Date(a.dateTo);d.setHours(23,59,59,999),r=r.filter(n=>(n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt))<=d)}return a.sortBy&&a.sortBy!=="date_desc"&&r.sort((d,n)=>{let j,A;switch(a.sortBy){case"name_asc":return j=`${d.firstName} ${d.lastName}`.toLowerCase(),A=`${n.firstName} ${n.lastName}`.toLowerCase(),j.localeCompare(A);case"name_desc":return j=`${d.firstName} ${d.lastName}`.toLowerCase(),A=`${n.firstName} ${n.lastName}`.toLowerCase(),A.localeCompare(j);case"date_asc":return j=d.createdAt?.toDate?d.createdAt.toDate():new Date(d.createdAt),A=n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt),j-A;default:return 0}}),r},[o,a.search,a.dateFrom,a.dateTo,a.sortBy]),E=i.useCallback(async(r,d=null)=>{if(!z)throw new Error("Must be logged in to create a candidate");let n={};const j=await Te(r,z.uid);return d&&(n=await Ne(d,j.id),await ee(j.id,n)),{...j,...n}},[z]),L=i.useCallback(async(r,d,n=null)=>{let j={};return n&&(j=await Ne(n,r)),await ee(r,{...d,...j})},[]),_=i.useCallback(async r=>{await $e(r)},[]),g=i.useCallback(async(r,d)=>{await ee(r,{status:d})},[]),p=i.useCallback(()=>{l(null)},[]);return{candidates:M,allLoadedCount:o.length,filteredCount:M.length,loading:x,loadingMore:y,error:D,hasMore:k,pageSize:oa,loadMore:S,addCandidate:E,editCandidate:L,removeCandidate:_,updateStatus:g,clearError:p}}function Ta(){const{data:a,isLoading:o,error:c,refetch:x}=xa({queryKey:Ke.candidates.stats(),queryFn:da,staleTime:6e4});return{stats:a||{total:0,new:0,in_progress:0,approved:0,rejected:0},loading:o,error:c,refetch:x}}function $a(a){const[o,c]=i.useState(()=>typeof window<"u"?window.matchMedia(a).matches:!1);return i.useEffect(()=>{if(typeof window>"u")return;const x=window.matchMedia(a);c(x.matches);const u=y=>c(y.matches);return x.addEventListener?(x.addEventListener("change",u),()=>x.removeEventListener("change",u)):(x.addListener(u),()=>x.removeListener(u))},[a]),o}function Va(){return $a("(max-width: 767px)")}const ge=10,Ia=[{value:"date_desc",label:"Newest First"},{value:"date_asc",label:"Oldest First"},{value:"name_asc",label:"Name (A-Z)"},{value:"name_desc",label:"Name (Z-A)"}];function ts(){const{toggleMobileMenu:a}=Qe(),[o,c]=Xe(),x=Pe(),u=Ye(),y=Va(),[N,D]=i.useState(o.get("search")||""),[l,k]=i.useState(o.get("status")||"all"),[v,z]=i.useState(o.get("job")||"all"),[f,m]=i.useState(o.get("sort")||"date_desc"),[S,M]=i.useState(o.get("from")||""),[E,L]=i.useState(o.get("to")||""),[_,g]=i.useState(!1),[p,r]=i.useState(1),[d,n]=i.useState(!1),[j,A]=i.useState(null),[se,te]=i.useState(!1),[ne,O]=i.useState(null),[Q,R]=i.useState(null),[ue,X]=i.useState(!1),{candidates:ie,allLoadedCount:me,filteredCount:J,loading:le,loadingMore:U,error:W,hasMore:I,loadMore:t,addCandidate:b,editCandidate:C}=_a({status:l,search:N,jobId:v,dateFrom:S,dateTo:E,sortBy:f}),{stats:h,refetch:P}=Ta(),{jobs:T}=Ue({status:"active"}),$=Math.ceil(J/ge),V=(p-1)*ge,G=V+ge,he=ie.slice(V,G);i.useEffect(()=>{r(1)},[N,l,v,S,E,f]),i.useEffect(()=>{const s=new URLSearchParams;N&&s.set("search",N),l!=="all"&&s.set("status",l),v!=="all"&&s.set("job",v),f!=="date_desc"&&s.set("sort",f),S&&s.set("from",S),E&&s.set("to",E),c(s,{replace:!0})},[N,l,v,f,S,E,c]),i.useEffect(()=>{const s=()=>O(null);return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const Re=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}):"Unknown",pe=()=>{D(""),k("all"),z("all"),m("date_desc"),M(""),L(""),g(!1)},q=N||l!=="all"||v!=="all"||S||E,Je=async(s,F)=>{te(!0);try{j?(await C(j.id,s,F),u.success("Candidate updated successfully")):(await b(s,F),u.success("Candidate added successfully")),n(!1),A(null),P()}catch(w){console.error("Error saving candidate:",w),u.error(w.message||"Failed to save candidate")}finally{te(!1)}},ke=async(s,F)=>{try{await ee(s,{status:F});const w=ve(F).label;u.success(`Status updated to ${w}`),P()}catch(w){console.error("Error updating status:",w),u.error("Failed to update status")}O(null)},We=async s=>{try{await $e(s),u.success("Candidate deleted"),P()}catch(F){console.error("Error deleting candidate:",F),u.error("Failed to delete candidate")}R(null),O(null)},ye=s=>{A(s),n(!0),O(null)};return e.jsxs(e.Fragment,{children:[e.jsx(sa,{title:"Candidates",subtitle:`${J} candidate${J!==1?"s":""}${q?" (filtered)":""}`,onMenuClick:a,actions:e.jsxs("div",{className:"header-actions-group",children:[e.jsx(B,{variant:"outline",leftIcon:e.jsx(va,{size:16}),onClick:()=>X(!0),children:"Bulk Upload CVs"}),e.jsx(B,{leftIcon:e.jsx(Y,{size:16}),onClick:()=>n(!0),children:"Add Candidate"})]})}),e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"candidates-stats",children:[e.jsxs("div",{className:`candidates-stat ${l==="all"?"candidates-stat-active":""}`,onClick:()=>k("all"),role:"button",tabIndex:0,children:[e.jsx("span",{className:"candidates-stat-value",children:h.total}),e.jsx("span",{className:"candidates-stat-label",children:"Total"})]}),e.jsxs("div",{className:`candidates-stat ${l==="new"?"candidates-stat-active":""}`,onClick:()=>k("new"),role:"button",tabIndex:0,children:[e.jsx("span",{className:"candidates-stat-value candidates-stat-new",children:h.new}),e.jsx("span",{className:"candidates-stat-label",children:"New"})]}),e.jsxs("div",{className:"candidates-stat",onClick:()=>k("all"),role:"button",tabIndex:0,children:[e.jsx("span",{className:"candidates-stat-value candidates-stat-progress",children:h.in_progress}),e.jsx("span",{className:"candidates-stat-label",children:"In Progress"})]}),e.jsxs("div",{className:`candidates-stat ${l==="approved"?"candidates-stat-active":""}`,onClick:()=>k("approved"),role:"button",tabIndex:0,children:[e.jsx("span",{className:"candidates-stat-value candidates-stat-approved",children:h.approved}),e.jsx("span",{className:"candidates-stat-label",children:"Approved"})]})]}),I&&e.jsxs("div",{className:"candidates-limit-warning",children:[e.jsx(de,{size:16}),e.jsxs("span",{children:["Showing first ",me," candidates. Use filters to narrow your search."]})]}),e.jsx(xe,{className:"candidates-filters",children:e.jsxs(De,{children:[e.jsxs("div",{className:"candidates-filters-row",children:[e.jsx("div",{className:"candidates-search",children:e.jsx(ea,{placeholder:"Search by name, email, or phone...",value:N,onChange:s=>D(s.target.value),leftIcon:e.jsx(ta,{size:18}),rightIcon:N?e.jsx("button",{className:"candidates-search-clear",onClick:()=>D(""),type:"button",children:e.jsx(H,{size:16})}):null})}),e.jsxs("div",{className:"candidates-filter-group",children:[e.jsxs("div",{className:"candidates-select-wrapper",children:[e.jsxs("select",{className:"candidates-select",value:l,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),re.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsx(oe,{size:16,className:"candidates-select-icon"})]}),e.jsxs("div",{className:"candidates-select-wrapper",children:[e.jsxs("select",{className:"candidates-select",value:v,onChange:s=>z(s.target.value),children:[e.jsx("option",{value:"all",children:"All Jobs"}),T.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]}),e.jsx(oe,{size:16,className:"candidates-select-icon"})]}),e.jsx(B,{variant:_?"secondary":"outline",leftIcon:e.jsx(ba,{size:16}),onClick:()=>g(!_),children:"Filters"})]})]}),_&&e.jsxs("div",{className:"candidates-advanced-filters",children:[e.jsxs("div",{className:"candidates-advanced-filters-row",children:[e.jsxs("div",{className:"candidates-filter-field",children:[e.jsx("label",{children:"From Date"}),e.jsx("input",{type:"date",value:S,onChange:s=>M(s.target.value),className:"candidates-date-input"})]}),e.jsxs("div",{className:"candidates-filter-field",children:[e.jsx("label",{children:"To Date"}),e.jsx("input",{type:"date",value:E,onChange:s=>L(s.target.value),className:"candidates-date-input"})]}),e.jsxs("div",{className:"candidates-filter-field",children:[e.jsx("label",{children:"Sort By"}),e.jsxs("div",{className:"candidates-select-wrapper",children:[e.jsx("select",{className:"candidates-select",value:f,onChange:s=>m(s.target.value),children:Ia.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx(oe,{size:16,className:"candidates-select-icon"})]})]})]}),q&&e.jsx("div",{className:"candidates-filter-actions",children:e.jsxs("button",{className:"candidates-clear-filters",onClick:pe,children:[e.jsx(H,{size:14}),"Clear all filters"]})})]})]})}),q&&!_&&e.jsxs("div",{className:"candidates-filter-tags",children:[N&&e.jsxs("span",{className:"candidates-filter-tag",children:['Search: "',N,'"',e.jsx("button",{onClick:()=>D(""),children:e.jsx(H,{size:14})})]}),l!=="all"&&e.jsxs("span",{className:"candidates-filter-tag",children:["Status: ",re.find(s=>s.value===l)?.label,e.jsx("button",{onClick:()=>k("all"),children:e.jsx(H,{size:14})})]}),v!=="all"&&e.jsxs("span",{className:"candidates-filter-tag",children:["Job: ",T.find(s=>s.id===v)?.title,e.jsx("button",{onClick:()=>z("all"),children:e.jsx(H,{size:14})})]}),(S||E)&&e.jsxs("span",{className:"candidates-filter-tag",children:["Date: ",S||"..."," to ",E||"...",e.jsx("button",{onClick:()=>{M(""),L("")},children:e.jsx(H,{size:14})})]}),e.jsx("button",{className:"candidates-clear-all",onClick:pe,children:"Clear all"})]}),W&&e.jsxs("div",{className:"candidates-error",children:[e.jsx(de,{size:18}),e.jsx("span",{children:W})]}),le?e.jsxs("div",{className:"candidates-loading",children:[e.jsx("div",{className:"candidates-loading-spinner"}),e.jsx("p",{children:"Loading candidates..."})]}):he.length===0?e.jsx(xe,{className:"candidates-empty-card",children:e.jsx(De,{children:e.jsx(na,{variant:q?"search":"candidates",title:q?"No candidates match your filters":"No candidates yet",description:q?"Try adjusting your search or filter criteria.":"Get started by uploading a CV or manually adding a candidate.",action:q?e.jsx(B,{variant:"outline",onClick:pe,children:"Clear Filters"}):e.jsx(B,{leftIcon:e.jsx(Y,{size:16}),onClick:()=>n(!0),children:"Add Candidate"})})})}):e.jsxs(e.Fragment,{children:[y?e.jsx("div",{className:"candidates-card-grid",children:he.map(s=>e.jsx(ya,{candidate:s,onEdit:ye,onDelete:R,onStatusChange:ke,statuses:re},s.id))}):e.jsx(xe,{children:e.jsx("div",{className:"candidates-table-wrapper",children:e.jsxs("table",{className:"candidates-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Candidate"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Applied"}),e.jsx("th",{children:"CV"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:he.map(s=>{const F=ve(s.status);return e.jsxs("tr",{onClick:()=>x(`/candidates/${s.id}`),className:"candidate-row-clickable",children:[e.jsx("td",{children:e.jsxs("div",{className:"candidate-info",children:[e.jsx("div",{className:"candidate-avatar",children:_e(s)}),e.jsxs("div",{className:"candidate-details",children:[e.jsx("div",{className:"candidate-name",children:Ce(s)}),e.jsxs("div",{className:"candidate-contact",children:[e.jsxs("span",{className:"candidate-email",children:[e.jsx(Ve,{size:12}),s.email]}),e.jsxs("span",{className:"candidate-phone",children:[e.jsx(Ie,{size:12}),s.phone]})]})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"candidate-job",children:s.jobTitle||"Not assigned"})}),e.jsx("td",{children:e.jsx(Ee,{variant:F.color,dot:!0,children:F.label})}),e.jsx("td",{className:"candidate-date",children:Re(s.createdAt)}),e.jsx("td",{children:s.cvUrl?e.jsxs("a",{href:s.cvUrl,target:"_blank",rel:"noopener noreferrer",className:"candidate-cv-link",title:"View CV",children:[e.jsx(we,{size:16}),e.jsx(Le,{size:12})]}):e.jsx("span",{className:"candidate-no-cv",children:"No CV"})}),e.jsx("td",{children:e.jsxs("div",{className:"candidate-actions-wrapper",children:[e.jsx("button",{className:"candidate-actions-btn",onClick:w=>{w.stopPropagation(),O(ne===s.id?null:s.id)},children:e.jsx(ha,{size:18})}),ne===s.id&&e.jsxs("div",{className:"candidate-dropdown",onClick:w=>w.stopPropagation(),children:[e.jsxs("button",{onClick:()=>ye(s),children:[e.jsx(Ze,{size:16}),"Edit"]}),e.jsx("div",{className:"candidate-dropdown-divider"}),e.jsx("div",{className:"candidate-dropdown-label",children:"Change Status"}),re.slice(0,6).map(w=>e.jsx("button",{onClick:()=>ke(s.id,w.value),className:s.status===w.value?"active":"",children:w.label},w.value)),e.jsx("div",{className:"candidate-dropdown-divider"}),e.jsxs("button",{className:"candidate-dropdown-danger",onClick:()=>R(s),children:[e.jsx(be,{size:16}),"Delete"]})]})]})})]},s.id)})})]})})}),($>1||I)&&e.jsxs("div",{className:"candidates-pagination",children:[e.jsxs("div",{className:"candidates-pagination-info",children:["Showing ",V+1,"-",Math.min(G,J)," of ",J,I&&" (more available)"]}),e.jsxs("div",{className:"candidates-pagination-controls",children:[e.jsx("button",{className:"candidates-pagination-btn",onClick:()=>r(s=>Math.max(1,s-1)),disabled:p===1,"aria-label":"Previous page",children:e.jsx(aa,{size:18})}),Array.from({length:Math.min(5,$)},(s,F)=>{let w;return $<=5||p<=3?w=F+1:p>=$-2?w=$-4+F:w=p-2+F,e.jsx("button",{className:`candidates-pagination-btn ${p===w?"active":""}`,onClick:()=>r(w),"aria-label":`Page ${w}`,"aria-current":p===w?"page":void 0,children:w},w)}),e.jsx("button",{className:"candidates-pagination-btn",onClick:()=>r(s=>Math.min($,s+1)),disabled:p===$,"aria-label":"Next page",children:e.jsx(Be,{size:18})}),I&&e.jsx("button",{className:"candidates-pagination-btn candidates-load-more",onClick:t,disabled:U,children:U?"Loading...":"Load More"})]})]})]})]}),e.jsx(ia,{isOpen:d,onClose:()=>{n(!1),A(null)},onSubmit:Je,candidate:j,loading:se}),e.jsx(La,{isOpen:ue,onClose:()=>X(!1),onSuccess:s=>{P(),X(!1)}}),Q&&e.jsx("div",{className:"delete-modal-backdrop",onClick:()=>R(null),children:e.jsxs("div",{className:"delete-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"delete-modal-icon",children:e.jsx(be,{size:24})}),e.jsx("h3",{children:"Delete Candidate"}),e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:Ce(Q)}),"? This will also delete their CV. This action cannot be undone."]}),e.jsxs("div",{className:"delete-modal-actions",children:[e.jsx(B,{variant:"outline",onClick:()=>R(null),children:"Cancel"}),e.jsx(B,{variant:"danger",onClick:()=>We(Q.id),children:"Delete"})]})]})})]})}export{ts as default};

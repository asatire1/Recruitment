import{c as q,y as i,x as e,J as w,S as D,K,L as U,M as X,F as Z,C as ee}from"./index-DNzbPSZC.js";import{B as C}from"./Button-B_cPFrbZ.js";import{H as se,C as g,a as v,S as ae,B as te}from"./Header-2UuRp0-b.js";import{E as le}from"./EmptyState-Bexdu60a.js";import{M as re}from"./Modal-D9gEPvkf.js";import{a as oe,J as _,C as ie,v as S,b as ne,e as ce,u as de,d as ue}from"./jobs-ThLx_BE1.js";import{u as he,a as je,E as me}from"./useJobs-Zaj5_4wT.js";import{P as B}from"./plus-CedeOkaj.js";import{C as xe}from"./clock-B8vd9NcM.js";import{P as A,T as W}from"./trash-2-WU6Zw85z.js";import{M as be}from"./map-pin-DB8Sq1EJ.js";import"./calendar-jRFJk9ro.js";import"./sanitize-DKce5u_M.js";import"./useQuery-BZQ_EdT0.js";const ge=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],O=q("pause",ge);const ve=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],I=q("play",ve),pe={title:[S.required,S.minLength(3)],category:[S.required],location:[S.required],hoursPerWeek:[S.number]},fe={title:"Job title",category:"Category",location:"Location",hoursPerWeek:"Hours per week"};function ye({isOpen:N,onClose:n,onSubmit:d,job:l=null,loading:c=!1}){const J=!!l,o=()=>({title:l?.title||"",category:l?.category||"",location:l?.location||"",description:l?.description||"",contractType:l?.contractType||"full_time",salary:l?.salary||"",hoursPerWeek:l?.hoursPerWeek?.toString()||""}),{values:a,errors:E,touched:u,handleChange:r,handleBlur:m,validate:F,resetForm:k,getFieldError:x}=oe(o(),pe,{debounceMs:300,validateOnChange:!0,validateOnBlur:!0,fieldNames:fe});i.useEffect(()=>{N&&k(o())},[N,l?.id]);const h=async j=>{if(j.preventDefault(),!F())return;const T={...a,hoursPerWeek:a.hoursPerWeek?Number(a.hoursPerWeek):null};await d(T)},p=()=>{k(o()),n()},b=j=>u[j]&&a[j]&&!E[j];return e.jsx(re,{isOpen:N,onClose:p,title:J?"Edit Job Listing":"Create New Job Listing",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outline",onClick:p,disabled:c,children:"Cancel"}),e.jsx(C,{onClick:h,loading:c,children:J?"Save Changes":"Create Job"})]}),children:e.jsxs("form",{onSubmit:h,className:"job-form",children:[e.jsx("div",{className:"job-form-row",children:e.jsx(w,{label:"Job Title",name:"title",value:a.title,onChange:r,onBlur:m,placeholder:"e.g., Dispenser, Pharmacist",error:x("title"),success:b("title"),required:!0})}),e.jsxs("div",{className:"job-form-row job-form-row-2col",children:[e.jsx(D,{label:"Category",name:"category",value:a.category,onChange:r,options:_,placeholder:"Select category",error:x("category"),required:!0}),e.jsx(D,{label:"Contract Type",name:"contractType",value:a.contractType,onChange:r,options:ie})]}),e.jsx("div",{className:"job-form-row",children:e.jsx(w,{label:"Location",name:"location",value:a.location,onChange:r,onBlur:m,placeholder:"e.g., Manchester City Centre, Bolton",error:x("location"),success:b("location"),required:!0})}),e.jsxs("div",{className:"job-form-row job-form-row-2col",children:[e.jsx(w,{label:"Salary",name:"salary",value:a.salary,onChange:r,placeholder:"e.g., £12-14/hour, £25,000-30,000",hint:"Optional"}),e.jsx(w,{label:"Hours per Week",name:"hoursPerWeek",type:"number",value:a.hoursPerWeek,onChange:r,onBlur:m,placeholder:"e.g., 40",error:x("hoursPerWeek"),hint:u.hoursPerWeek?void 0:"Optional"})]}),e.jsx("div",{className:"job-form-row",children:e.jsx(K,{label:"Job Description",name:"description",value:a.description,onChange:r,placeholder:"Describe the role, responsibilities, and requirements...",rows:5,hint:"Optional"})})]})})}function Be(){const{toggleMobileMenu:N}=U(),n=X(),[d,l]=i.useState(""),[c,J]=i.useState("all"),[o,a]=i.useState("all"),[E,u]=i.useState(!1),[r,m]=i.useState(null),[F,k]=i.useState(!1),[x,h]=i.useState(null),[p,b]=i.useState(null),{jobs:j,loading:T,error:M,addJob:H,editJob:$}=he({status:o,category:c,search:d}),{stats:P,refetch:z}=je();i.useEffect(()=>{const s=()=>h(null);return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const R=s=>{if(!s)return"Unknown";const t=s.toDate?s.toDate():new Date(s),Y=new Date-t,y=Math.floor(Y/(1e3*60*60*24));return y===0?"Today":y===1?"Yesterday":y<7?`${y} days ago`:y<30?`${Math.floor(y/7)} weeks ago`:t.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},V=async s=>{k(!0);try{r?(await $(r.id,s),n.success("Job listing updated")):(await H(s),n.success("Job listing created")),u(!1),m(null),z()}catch(t){console.error("Error saving job:",t),n.error(t.message||"Failed to save job listing")}finally{k(!1)}},G=async s=>{const t=s.status==="active"?"paused":"active";try{await de(s.id,{status:t}),n.success(`Job ${t==="active"?"activated":"paused"}`),z()}catch(f){console.error("Error updating status:",f),n.error("Failed to update job status")}h(null)},Q=async s=>{try{await ue(s),n.success("Job listing deleted"),z()}catch(t){console.error("Error deleting job:",t),n.error("Failed to delete job listing")}b(null),h(null)},L=s=>{m(s),u(!0),h(null)};return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Job Listings",subtitle:"Manage open positions across your branches",onMenuClick:N,actions:e.jsx(C,{leftIcon:e.jsx(B,{size:16}),onClick:()=>u(!0),children:"New Job Listing"})}),e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"jobs-stats",children:[e.jsx(g,{className:"jobs-stat-card",children:e.jsxs(v,{children:[e.jsx("div",{className:"jobs-stat-icon jobs-stat-icon-active",children:e.jsx(I,{size:18})}),e.jsx("div",{className:"jobs-stat-value",children:P.active}),e.jsx("div",{className:"jobs-stat-label",children:"Active"})]})}),e.jsx(g,{className:"jobs-stat-card",children:e.jsxs(v,{children:[e.jsx("div",{className:"jobs-stat-icon jobs-stat-icon-paused",children:e.jsx(O,{size:18})}),e.jsx("div",{className:"jobs-stat-value",children:P.paused}),e.jsx("div",{className:"jobs-stat-label",children:"Paused"})]})}),e.jsx(g,{className:"jobs-stat-card",children:e.jsxs(v,{children:[e.jsx("div",{className:"jobs-stat-icon jobs-stat-icon-closed",children:e.jsx(xe,{size:18})}),e.jsx("div",{className:"jobs-stat-value",children:P.closed}),e.jsx("div",{className:"jobs-stat-label",children:"Closed"})]})}),e.jsx(g,{className:"jobs-stat-card",children:e.jsxs(v,{children:[e.jsx("div",{className:"jobs-stat-icon jobs-stat-icon-total",children:e.jsx(Z,{size:18})}),e.jsx("div",{className:"jobs-stat-value",children:P.total}),e.jsx("div",{className:"jobs-stat-label",children:"Total"})]})})]}),e.jsx(g,{className:"jobs-filters",children:e.jsx(v,{children:e.jsxs("div",{className:"jobs-filters-row",children:[e.jsx("div",{className:"jobs-search",children:e.jsx(w,{placeholder:"Search job listings...",value:d,onChange:s=>l(s.target.value),leftIcon:e.jsx(ae,{size:18})})}),e.jsxs("div",{className:"jobs-filter-group",children:[e.jsxs("select",{className:"jobs-select",value:c,onChange:s=>J(s.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),_.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("select",{className:"jobs-select",value:o,onChange:s=>a(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})]})})}),M&&e.jsxs("div",{className:"jobs-error",children:[e.jsx(ee,{size:18}),e.jsx("span",{children:M})]}),T?e.jsxs("div",{className:"jobs-loading",children:[e.jsx("div",{className:"jobs-loading-spinner"}),e.jsx("p",{children:"Loading jobs..."})]}):j.length===0?e.jsx(g,{className:"jobs-empty-card",children:e.jsx(v,{children:e.jsx(le,{variant:d||c!=="all"||o!=="all"?"search":"jobs",title:d||c!=="all"||o!=="all"?"No jobs match your filters":"No job listings yet",description:d||c!=="all"||o!=="all"?"Try adjusting your search or filter criteria.":"Create your first job listing to start receiving candidate applications.",action:!d&&c==="all"&&o==="all"&&e.jsx(C,{leftIcon:e.jsx(B,{size:16}),onClick:()=>u(!0),children:"Create Job Listing"})})})}):e.jsx("div",{className:"jobs-grid",children:j.map(s=>{const t=ne(s.status);return e.jsx(g,{className:"job-card",children:e.jsxs(v,{children:[e.jsxs("div",{className:"job-card-header",children:[e.jsx(te,{variant:t.color,dot:!0,children:t.label}),e.jsxs("div",{className:"job-card-menu-wrapper",children:[e.jsx("button",{className:"job-card-menu",onClick:f=>{f.stopPropagation(),h(x===s.id?null:s.id)},children:e.jsx(me,{size:18})}),x===s.id&&e.jsxs("div",{className:"job-card-dropdown",onClick:f=>f.stopPropagation(),children:[e.jsxs("button",{onClick:()=>L(s),children:[e.jsx(A,{size:16}),"Edit"]}),e.jsx("button",{onClick:()=>G(s),children:s.status==="active"?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:16}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16}),"Activate"]})}),e.jsxs("button",{className:"job-card-dropdown-danger",onClick:()=>b(s),children:[e.jsx(W,{size:16}),"Delete"]})]})]})]}),e.jsx("h3",{className:"job-card-title",children:s.title}),e.jsx("p",{className:"job-card-category",children:ce(s.category)}),e.jsxs("div",{className:"job-card-meta",children:[e.jsxs("div",{className:"job-card-meta-item",children:[e.jsx(be,{size:14}),e.jsx("span",{children:s.location})]}),s.salary&&e.jsx("div",{className:"job-card-meta-item",children:e.jsx("span",{className:"job-card-salary",children:s.salary})})]}),e.jsxs("div",{className:"job-card-footer",children:[e.jsxs("span",{className:"job-card-date",children:["Posted ",R(s.createdAt)]}),e.jsx("div",{className:"job-card-actions",children:e.jsx("button",{className:"job-card-action",title:"Edit",onClick:()=>L(s),children:e.jsx(A,{size:16})})})]})]})},s.id)})})]}),e.jsx(ye,{isOpen:E,onClose:()=>{u(!1),m(null)},onSubmit:V,job:r,loading:F}),p&&e.jsx("div",{className:"delete-modal-backdrop",onClick:()=>b(null),children:e.jsxs("div",{className:"delete-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"delete-modal-icon",children:e.jsx(W,{size:24})}),e.jsx("h3",{children:"Delete Job Listing"}),e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:p.title}),"? This action cannot be undone."]}),e.jsxs("div",{className:"delete-modal-actions",children:[e.jsx(C,{variant:"outline",onClick:()=>b(null),children:"Cancel"}),e.jsx(C,{variant:"danger",onClick:()=>Q(p.id),children:"Delete"})]})]})})]})}export{Be as default};
